<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Customer Segmentation — Interactive Dashboard</title>
  <meta name="description" content="Customer segments visualized with ECharts." />
  <style>
    :root{
      --bg:#0b0f19; --card:#121827; --muted:#9aa4b2; --text:#e5e7eb; --accent:#6ee7b7; --accent2:#93c5fd;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    a{color:var(--accent2);text-decoration:none}
    header{display:flex;align-items:center;gap:16px;margin:8px 0 16px}
    .btn{display:inline-block;background:var(--card);border:1px solid #1f2937;color:var(--text);
         padding:10px 14px;border-radius:999px;cursor:pointer}
    .btn:hover{border-color:#334155}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:12px}
    .card h3{margin:0 0 8px;font-size:18px}
    .chart{width:100%;height:320px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #1f2937;padding:8px 10px;text-align:left}
    footer{margin:24px 0;color:var(--muted);font-size:14px}
    @media (max-width: 720px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a href="index.html" class="btn">← Back to Portfolio</a>
      <h1 style="margin:0;">Customer Segmentation</h1>
    </header>

    <div class="grid">
      <div class="card">
        <h3>Segment Share</h3>
        <div id="share" class="chart"></div>
      </div>
      <div class="card">
        <h3>Average Spend</h3>
        <div id="avgSpend" class="chart"></div>
      </div>
      <div class="card">
        <h3>Average Group Size</h3>
        <div id="avgGroup" class="chart"></div>
      </div>
      <div class="card">
        <h3>Average Visit Frequency</h3>
        <div id="avgFreq" class="chart"></div>
      </div>
    </div>

    <div class="card" style="margin-top:16px;">
      <h3>Summary Table</h3>
      <div id="tableWrap"></div>
    </div>

    <footer>© <span id="year"></span> Customer Segmentation — ECharts</footer>
  </div>

  <!-- ECharts CDN -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const charts = {
      share: echarts.init(document.getElementById('share')),
      avgSpend: echarts.init(document.getElementById('avgSpend')),
      avgGroup: echarts.init(document.getElementById('avgGroup')),
      avgFreq: echarts.init(document.getElementById('avgFreq')),
    };
    window.addEventListener('resize', ()=>Object.values(charts).forEach(c=>c.resize()));

    function parseCSV(text){
      const lines = text.trim().split(/\r?\n/);
      const headers = lines[0].split(',').map(h=>h.trim());
      const idx = Object.fromEntries(headers.map((h,i)=>[h,i]));
      const rows = [];
      for (let i=1;i<lines.length;i++){
        if (!lines[i].trim()) continue;
        const cells = lines[i].split(',').map(s=>s.trim());
        rows.push({
          ClusterLabel: String(cells[idx.ClusterLabel]),
          Spend: Number(cells[idx.Spend]),
          GroupSize: Number(cells[idx.GroupSize]),
          VisitFrequency: Number(cells[idx.VisitFrequency]),
        });
      }
      return rows;
    }

    function summarize(rows){
      const by = {};
      for (const r of rows){
        if (!by[r.ClusterLabel]) by[r.ClusterLabel] = {n:0, spend:0, group:0, freq:0};
        const b = by[r.ClusterLabel];
        b.n += 1;
        b.spend += r.Spend;
        b.group += r.GroupSize;
        b.freq  += r.VisitFrequency;
      }
      const labels = Object.keys(by).sort();
      const counts = labels.map(k=>by[k].n);
      const avgSpend = labels.map(k=> +(by[k].spend/by[k].n).toFixed(2));
      const avgGroup = labels.map(k=> +(by[k].group/by[k].n).toFixed(2));
      const avgFreq  = labels.map(k=> +(by[k].freq /by[k].n).toFixed(2));
      return {labels, counts, avgSpend, avgGroup, avgFreq};
    }

    function render({labels, counts, avgSpend, avgGroup, avgFreq}){
      charts.share.setOption({
        tooltip:{trigger:'item'},
        series:[{type:'pie', radius:['35%','70%'],
          data: labels.map((l,i)=>({name:l, value:counts[i]})),
          label:{formatter:'{b}: {d}%'}
        }]
      });
      charts.avgSpend.setOption({
        tooltip:{trigger:'axis'},
        xAxis:{type:'category', data:labels},
        yAxis:{type:'value', name:'$ (avg)'},
        series:[{type:'bar', data:avgSpend}]
      });
      charts.avgGroup.setOption({
        tooltip:{trigger:'axis'},
        xAxis:{type:'category', data:labels},
        yAxis:{type:'value', name:'people (avg)'},
        series:[{type:'bar', data:avgGroup}]
      });
      charts.avgFreq.setOption({
        tooltip:{trigger:'axis'},
        xAxis:{type:'category', data:labels},
        yAxis:{type:'value', name:'visits (avg)'},
        series:[{type:'bar', data:avgFreq}]
      });

      const tbody = labels.map((l,i)=>
        `<tr><td>${l}</td><td>${counts[i]}</td><td>${avgSpend[i]}</td><td>${avgGroup[i]}</td><td>${avgFreq[i]}</td></tr>`
      ).join('');
      document.getElementById('tableWrap').innerHTML =
        `<table>
          <thead><tr><th>Cluster</th><th>Count</th><th>Avg Spend</th><th>Avg Group</th><th>Avg Visit Freq</th></tr></thead>
          <tbody>${tbody}</tbody>
         </table>`;
    }
function loadDemo(){
  const demoCSV = `ClusterLabel,Spend,GroupSize,VisitFrequency
Local,32,2,5
Local,28,2,4
Local,35,3,5
Local,30,2,6
Local,29,2,4
Tourist,60,3,2
Tourist,55,4,2
Tourist,70,3,3
School,12,20,1
School,10,18,1
Member,45,2,6
Member,50,2,6
Member,48,3,5
Member,52,2,7`;
  const rows = parseCSV(demoCSV);
  render(summarize(rows));
}

    // Auto-load demo on page load
    loadDemo();
  </script>
</body>
</html>
